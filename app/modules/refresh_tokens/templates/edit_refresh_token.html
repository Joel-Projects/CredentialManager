{% extends "base.html" %}
{% import 'macros.html' as macros %}
{% block title %}Credential Manager - Edit Refresh Token - {{ refresh_token.app_name }} - {{ refresh_token.redditor }}{% endblock %}
{% block breadCrumbs %}
    <!--suppress HtmlUnknownTarget -->
    {% if user and (current_user.is_admin or current_user.is_internal or refresh_token.check_owner(current_user)) %}
        <li class="breadcrumb-item"><a href={{ url_for('users.users') }}>Users</a></li>
        <li class="breadcrumb-item"><a href="/u/{{ user.username }}">{{ user.username }}</a></li>
        <li class="breadcrumb-item"><a href="/u/{{ user.username }}/refresh_tokens/">Refresh Tokens</a></li>
    {% else %}
        <li class="breadcrumb-item"><a href="/refresh_tokens/">Refresh Tokens</a></li>
    {% endif %}
    <li class="breadcrumb-item"><a href="/refresh_tokens/{{ refresh_token.id }}">{{ refresh_token.app_name }} - {{ refresh_token.redditor }}</a></li>
{% endblock %}
{% block activeItem %}active item{% endblock %}
{% block content %}
    <!--suppress ALL -->
    <script src="{{ url_for('refresh_tokens.static', filename='js/edit_refresh_token.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/edit.css') }}">
    <body>
    <div class="container">
        {#        <div class="row justify-content-lg-center">#}
        {#            <div class="col-lg-4">#}
        <div class="jumbotron">
            <h4>Refresh Token Info</h4>
            <hr style="border-top: 1px solid">
            {% for attr, displayName in refresh_token._infoAttrs.items() %}
                <strong>{{ displayName }}:</strong>
                <br>
                {% if attr == 'owner' and not refresh_token.check_owner(current_user) and (current_user.is_admin or current_user.is_internal) %}
                    <a href="/u/{{ refresh_token.getInfoAttr(attr).username }}">{{ refresh_token.getInfoAttr(attr).username }}</a>
                    <br>
                    <br>
                {% elif refresh_token.getInfoAttr(attr).__class__.__name__ == 'datetime' %}
                    <a>{{ moment(refresh_token.getInfoAttr(attr)).format('M/DD/YYYY, h:mm:ss a zz') }}</a>
                    <br>
                    <br>
                {% elif attr == 'reddit_app' %}
                    <a href="/reddit_apps/{{ refresh_token.getInfoAttr(attr).id }}">{{ refresh_token.getInfoAttr(attr).app_name }}</a>
                    <br>
                    <br>
                {% elif attr == 'refresh_token' %}
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" style="background-color: grey;color: lightgray" readonly="" value="{{ refresh_token.getInfoAttr(attr) }}" aria-describedby="copyBox">
                        <div class="input-group-append">
                            <button class="input-group-text btn-dark" type="button" onclick="copy(this)" id="copyBox"><a class="fas fa-clipboard"></a></button>
                        </div>
                    </div>
                {% elif attr == 'revoked_at' %}
                    <a>{% if refresh_token.getInfoAttr(attr) %}{{ refresh_token.getInfoAttr(attr) }}{% else %}Never{% endif %}</a>
                    <br>
                    <br>
                {% elif attr == 'scopes' %}
                    <div class="container">
                        {% for row in refresh_token.chunkScopes %}
                            <div class="row">
                                {% for scope, enabled, description in row %}
                                    <div class="col-sm-3">
                                        <div class="container">
                                            {{ scope }}<sup><span class="d-inline-block" style="opacity: 0.6" tabindex="0" data-toggle="tooltip" title="" data-original-title="{{ description }}"><i class="far fa-question-circle"></i></span></sup>
                                            {% if enabled %}
                                                <span><i class="fas fa-check-circle" style="font-size: 20px; color: #00bc8c"></i></span>
                                            {% else %}
                                                <span class="d-inline-block"><i class="fas fa-times-circle" style="font-size: 20px; color: #00bc8c"></i></span>
                                                {#                                        <div class="col-sm"><a class="fas fa-times" style="font-size: 28px; color: #e74c3c"><span class="tooltiptext">{{ description }}</span></a></div>#}
                                            {% endif %}
                                                </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                    <br>
                    <br>
                {% else %}
                    <a>{{ refresh_token.getInfoAttr(attr) }}</a>
                    <br>
                    <br>
                {% endif %}
            {% endfor %}
            <button class="btn btn-danger" id="delete" data-target="#confirmationModal" onclick="showDeleteModal('{{ refresh_token.app_name }}', 'refresh_tokens', {{ refresh_token.id }})" data-toggle="modal">Delete</button>
            {#                </div>#}
            {#            </div>#}
        </div>
    </div>
    </body>
{% endblock %}
