{% extends "base.html" %}
{% block title %}Credential Manager Manager - Users{% endblock %}
{% block breadCrumbs %}
    <li class="breadcrumb-item"><a href={{ url_for('users.users') }}>Users</a></li>
{% endblock %}
{% block content %}
    <body>
    <script src="{{ url_for('users.static', filename='js/users.js') }}"></script>
    <div class="container">
        <div class="table-responsive">
            {{ usersTable }}
            <div class="container">
                <div class="row">
                    <div class="col">
                        <button class="btn btn-primary" id="addUser" data-toggle="modal" data-target="#newUserModal">Add User</button>
                    </div>
                    {% include 'paginator.html' %}
                </div>
                <div class="modal fade" id="newUserModal" tabindex="-1" role="dialog" aria-labelledby="newUserModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="newUserModalLabel">Add User</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            </div>
                            <div class="modal-body">
                                <form id="createUserForm" method="post" resource="/users">
                                    <div class="form-group">
                                        {{ usersForm.username.label }}
                                        {% if usersForm.username.errors %}
                                            {{ usersForm.username(size=16, class_="form-control is-invalid", onkeypress="clearInvalidState(this)", oninvalid="invalidateField(this)") }}
                                            {% for error in usersForm.username.errors %}
                                                <div class="invalid-feedback" id="usernameFeedback">{{ error }}</div>
                                            {% endfor %}
                                        {% else %}
                                            {{ usersForm.username(size=16, class_="form-control", onkeypress="clearInvalidState(this)", oninvalid="invalidateField(this)") }}
                                        {% endif %}
                                    </div>
                                    <div class="form-group">
                                        {{ usersForm.password.label }}
                                        {{ usersForm.password(size=32, class_="form-control") }}<br>
                                        {% for error in usersForm.password.errors %}
                                            <span style="color: red;">[{{ error }}]</span>
                                        {% endfor %}
                                    </div>
                                    {#                                    <div class="form-group">#}
                                    {#                                        {{ usersForm.default_redirect_uri.label }}#}
                                    {#                                        {% if usersForm.default_redirect_uri.errors %}#}
                                    {#                                            {{ usersForm.default_redirect_uri(size=16, class_="form-control is-invalid", onkeypress="clearInvalidState(this)", oninvalid="invalidateField(this)") }}#}
                                    {#                                            {% for error in usersForm.default_redirect_uri.errors %}#}
                                    {#                                                <div class="invalid-feedback" id="default_redirect_uriFeedback">{{ error }}</div>#}
                                    {#                                            {% endfor %}#}
                                    {#                                        {% else %}#}
                                    {#                                            {{ usersForm.default_redirect_uri(size=16, class_="form-control", onkeypress="clearInvalidState(this)", oninvalid="invalidateField(this)") }}#}
                                    {#                                        {% endif %}#}
                                    {#                                        <small id="headerHelp" class="form-text text-muted">Defines the user's default redirect URI for reddit apps for OAuth 2 authentication</small>#}
                                    {#                                    </div>#}
                                    <div class="form-group">
                                        <label for="custom_settings">Default Settings</label>
                                        <div id="custom_settings"></div>
                                    </div>
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/json-editor/0.7.28/jsoneditor.min.js" integrity="sha256-51+oMmpgSgS4jV5/DcGKnDHIOL6Jeie2i7ka6sPQVro=" crossorigin="anonymous"></script>
                                    <script>
                                        // Set default options
                                        JSONEditor.defaults.options.theme = 'bootstrap3';

                                        // Initialize the editor
                                        var editor = new JSONEditor(document.getElementById("custom_settings"), {
                                            schema: {
                                                "type": "array",
                                                "format": "table",
                                                "title": null,
                                                "uniqueItems": true,
                                                "items": {
                                                    "type": "object",
                                                    "title": "Setting",
                                                    "properties": {
                                                        "Setting": {
                                                            "type": "string",
                                                            "enum": [
                                                                "redirect_uri",
                                                                "database_flavor",
                                                                "database_host",
                                                                "user_agent",
                                                                "ssh_host",
                                                                "ssh_user"
                                                            ]
                                                        },
                                                        "Default Value": {
                                                            "type": "string"
                                                        }
                                                    }
                                                },
                                                "default": [{}]
                                            }
                                        });
                                    </script>
                                    <style>
                                        #custom_settings > div > h3 {
                                            display: none !important;
                                        }
                                    </style>
                                    <br>
                                    <div class="form-group">
                                        <div class="custom-control custom-switch">
                                            {{ usersForm.is_admin(value='n', class_="custom-control-input") }}
                                            {{ usersForm.is_admin.label(class_='custom-control-label') }}
                                        </div>
                                    </div>
                                    {% if current_user.is_internal %}
                                        <div class="form-group">
                                            <div class="custom-control custom-switch">
                                                {{ usersForm.is_internal(value='n', class_="custom-control-input") }}
                                                {{ usersForm.is_internal.label(class_='custom-control-label') }}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="custom-control custom-switch">
                                                {{ usersForm.is_regular_user(value='n', class_="custom-control-input") }}
                                                {{ usersForm.is_regular_user.label(class_='custom-control-label') }}
                                            </div>
                                        </div>
                                    {% endif %}
                                    <div class="form-group">
                                        <div class="custom-control custom-switch">
                                            {{ usersForm.is_active(value='y', class_="custom-control-input") }}
                                            {{ usersForm.is_active.label(class_='custom-control-label') }}
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <button type="submit" name="submit" class="btn btn-primary" id="userCreate" onclick="createItem(this, 'createUserForm')">Create</button>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </body>
{% endblock %}
